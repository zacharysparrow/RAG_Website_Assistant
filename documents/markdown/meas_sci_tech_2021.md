# stoBEST: an efficient methodology for increased spatial resolution in two-component molecular tagging velocimetry

https://doi.org/10.1088/1361-6501/abb1e4

# **stoBEST: an efficient methodology for increased spatial resolution in two-component molecular tagging velocimetry**

## **Michael Pearce**[1,](#page-1-0)[4](#page-1-1)**, Zachary Sparrow**[1](#page-1-0)[,2](#page-1-2)[,4](#page-1-1)**, Thabiso R Mabote**[1](#page-1-0)[,3](#page-1-3) **and Rodrigo S ´anchez-Gonz ´alez**[2](#page-1-2)

<span id="page-1-2"></span><span id="page-1-0"></span><span id="page-1-2"></span><span id="page-1-0"></span><sup>1</sup> Department of Mathematics, Statistics, and Computer Science, St. Olaf College, 1520 St. Olaf Ave., Northfield, Minnesota 55057, United States of America <sup>2</sup> Department of Chemistry, St. Olaf College, 1520 St. Olaf Ave., Northfield, Minnesota 55057, United States of America <sup>3</sup> Department of Physics, St. Olaf College, 1520 St. Olaf Ave., Northfield, Minnesota 55057, United States of America

<span id="page-1-3"></span><span id="page-1-3"></span>E-mail: [rodrigog@stolaf.edu](mailto:rodrigog@stolaf.edu)

Received 30 June 2020, revised 11 August 2020 Accepted for publication 24 August 2020 Published 15 December 2020

#### **Abstract**

A new methodology to analyze two-component molecular tagging velocimetry image pairs is presented. Velocity measurements with high spatial resolution are achieved by determining grid displacements at the intersections as well as along the grid lines using a multivariate adaptive regression splines parameterization along the segments connecting adjacent grid intersections. The methodology can detect the orientation of the grid, contains redundant steps for increased reliability, and handles cases where parts of the grid are missing, indicating potential for automation. Initial demonstration of the algorithm's performance was illustrated using synthetic data sets derived from Computational Fluid Dynamics simulations and compared to Hough-transform and cross-correlation methodologies. Besides providing comparable results in terms of precision and accuracy to previously reported methodologies, the analysis of images by the proposed methodology results in significantly increased spatial resolution of the flow displacement determinations along the grid lines with comparable precision and accuracy. This methodology's ability to handle different grid orientations without modifications was assessed using synthetic datasets with grids formed by sets of parallel lines at 90, 45, and 30 degrees from the vertical axis. Comparable results in terms of precision and accuracy were obtained across grid orientations, with all uncertainties below 0.1 pixel for images with signal-to-noise levels exceeding 5, and within 0.5 pixel for the noisiest image sets.

Keywords: molecular tagging velocimetry, high-speed flows, data analysis

(Some figures may appear in colour only in the online journal)

#### **1. Introduction**

The quantitative study of flows has a natural requirement of reliable experimental and data analysis methodologies that can provide accurate and spatially-resolved velocity measurements. A variety of molecular tagging velocimetry (MTV) techniques have been developed over the last few decades to characterize liquid and gaseous flows, and they vary in complexity depending on the nature of the flow, experimental facilities' limitations, and the intended application. MTV is an alternative to particle image velocimetry (PIV) when the introduction of particles into the flow is difficult, intrusive, or results in large errors (Huffman and Elliot [2009](#page-14-0), Sakurai *et al* [2015\)](#page-14-1). MTV techniques share a general principle, requiring sequential images that capture an optically-induced process such as fluorescence or phosphorescence using lasers while the flow is in motion. When a laser beam is shaped into a thin line by either focusing or partial blocking using a mask, the resulting emission line in the flow is employed to track motion in one direction. When sets of parallel laser lines are simultaneously aligned from two different directions, a grid is formed. The movement of this grid, specifically its translation and local distortions, is monitored in time by sequential imaging and used to provide local flow displacement information. Experimentally, at least two images are required to provide a velocity measurement: a time-zero image immediately following a laser pulse that will result in straight emission lines due to their recent formation, and a time-delayed image when the previously formed lines have moved and distorted due to flow motion. Spatially-resolved velocities are estimated by determining local displacements of the tagged regions from one image to the next and dividing these displacements by the time-delay between the two images.

Despite the existence of a variety of MTV techniques such as the ones discussed in (Koochesfahani and Nocera [2007\)](#page-14-2), including those that require seeding special chemical species to generate light emission and those that do not require seeding, image processing methodologies tailored for specific implementations are required. In the case of gridded MTV techniques, where two- or three-velocity components are desired, the image analysis tracks the displacement of the grid intersections. This analysis requires some effort to write algorithms able to detect and track grid displacements. Of these, the highest accuracies have been achieved using cross-correlation methodologies (Gendrich and Koochesfahani [1996,](#page-14-3) Bathel *et al* [2011](#page-14-4), Ramsey and Pitz [2011\)](#page-14-5). Efforts to parameterize the MTV grid lines that have the potential of increasing the spatial resolution beyond that provided by the grid line intersections are limited and the analysis becomes computationally complicated when line distortions are severe (Sanchez-Gonzalez *et al* [2015\)](#page-14-6). Although some of these analysis methodologies have demonstrated high precision and accuracy using synthetic data sets, their advantages are suppressed by the specificity of the data they can analyze and limitations in handling real data with varying quality. Some efforts have been made to develop algorithms that can analyze MTV images characterized by high noise and non-uniform intensities, but at the expense of accuracy (Charonko *et al* [2020\)](#page-14-7). The use of analysis methodologies that are not specific for the recognition and analysis of grids has been reported in the literature. Specifically, an image correlation velocimetry (ICV) approach (Tokumaru and Dimotakis [1995,](#page-14-8) Gornowicz [1997\)](#page-14-9) capable of determining displacement fields in images of particles, molecular tracers, and in general images with unique local features, has been implemented to analyze MTV images (Pitz *et al* [2000](#page-14-10)).

This work describes a methodology developed to analyze two-component MTV image pairs, presenting the following advantages that are not offered collectively by previously published works: (1) two-component velocity determinations at the grid intersections and continuous two-component determinations along the grid lines, resulting in considerably improved spatial resolution; (2) high potential for automation because it is able to process images acquired under a variety of experimental conditions in terms of laser alignment and grid line spacing; (3) ability to handle images with low signal-tonoise and even missing sections of the grid; and (4) as implemented in this work, it can be efficiently written in the free R language using open access packages (R Core Team [2020\)](#page-14-11).

#### **2. The stoBEST methodology: overview**

The proposed methodology is designed to provide a continuous measurement of grid displacements in image pairs resulting from two-component MTV experiments. The analysis of these image pairs, consisting of a time-zero image and a time-delayed image, results in two-component velocity determinations at the grid intersections and at multiple points along the grid lines. This methodology, St. Olaf Blob Extraction and Spline Tracking (stoBEST), identifies intersection points in the MTV laser grid using blob and feature detection techniques, and then uses a multivariate adaptive regression splines parameterization to fit and track the grid lines connecting adjacent intersections. The spline tracking portion of the algorithm subdivides the parameterized timezero grid between two intersection points into smaller sections and finds their parameterized counterparts in the time-delayed image. This unique feature permits the determination of grid displacements with arbitrary resolution along the entire grid. The general structure and progression of the proposed methodology follows a sequence of four main steps: (1) image preprocessing, (2) intersection identification, (3) grid measurement and tracking, and (4) vector field generation. These steps are briefly outlined in the following paragraphs, and each step is explained in detail in sections IIa–IId.

The image pre-processing step consists of noise reduction in the images by smoothing, local intensity thresholding to accentuate features, and conversion of the raw greyscale images into binary black and white images. This preprocessing step generates binary images that are employed by subsequent steps.

The intersection identification step starts with morphological processing of the binary images. This morphological processing stage parameterizes the features in the time-zero binary image using the Hough transform (Duda and Hart [1972](#page-14-12)) to gather information about grid orientation and grid spacing, and also has the purpose of defining broad areas where the grid intersections are likely to occur. This is followed by a blob detection phase that uses the full-intensity pre-processed raw images to detect the grid intersections based on intensity gradients. The final determination of intersection points in the time-zero and time-delayed images results from a comparison of the morphological processing and blob detection outputs, providing built-in redundancy, which is important for automation of the process as well as for added reliability of the subsequent grid measurement and tracking step.

The grid measurement and tracking step starts by coupling the intersection points identified by the intersection identification step in the time-zero image to their counterparts in the time-delayed image. At this point, the algorithm achieves a determination of the displacement of individual grid intersections, a common feature with other two-component MTV analysis methodologies (Gendrich and Koochesfahani [1996](#page-14-3), Ramsey and Pitz [2011,](#page-14-5) Sanchez-Gonzalez *et al* [2015](#page-14-6)). The coupled point pairs, along with the grid orientation and grid spacing information obtained previously, are used in an intersection point neighbor identification stage to determine adjacent intersection points. This is followed by a multivariate adaptive regression splines parameterization along the grid segments connecting such adjacent intersections. These parameterizations in the time-zero and time-delayed grids, which can be performed with arbitrary resolution, result in the increased spatial resolution of the MTV measurement by providing displacement determinations at specific intervals along the grid.

Finally, in the vector field generation step, the information resulting from grid measurement and tracking is used to generate a displacement vector map. Optional interpolation can follow to create a continuous velocity map across the entire field of view.

The following subsections describe in detail the principles behind these four sequential steps of the stoBEST methodology. The progression of the methodology is accompanied by a combination of synthetic and experimental MTV grid images, selected to best illustrate the principles behind each step. An implementation of this methodology was written in the R language, a popular tool for statistical modeling and data analysis. Some advantages of R include its ability to handle and structure complex data, the open source nature of the language, the open access of a multitude of packages, and its consistent implementation and performance across different operating system platforms. Additional information about this implementation in R is available from the authors upon request.

#### *2.1. Step 1: Image pre-processing*

Raw data consists of pairs of greyscale images that result from an MTV experiment: a time-zero and a time-delayed image. A raw experimental image is often characterized by a number of imperfections that include low signal-to-noise levels, varying brightness levels across the image due to flow inhomogeneities, as well as deformed and missing line segments caused by strong gradients, diffusion, and out-of-plane flow movement. Images are first blurred using a 0th order Deriche filter to minimize the effects of noise. This filter blurs the image and was chosen since it provides a fast approximation to a Gaussian filter (Deriche [1993\)](#page-14-13). In this methodology, as tested, the spatial filter has a standard deviation of about half of the tagged lines' width. It should be noted that filtering has been shown to be an error-inducing factor in the analysis of MTV images, and the errors increase when the filter size is large relative to the tagged lines' width (Caso and Bohl [2014\)](#page-14-14). Thus, any specific implementation of this and other MTV analysis methodologies have to account for the specific type and size of smoothing filters. Locating areas that contain grid intersections in the next step requires conversion of the images from grayscale to binary format, which starts by thresholding. The main purpose of thresholding is to reduce the possibility of false feature detection by eliminating irrelevant intensities that do not belong to the grid. Since drastic intensity variations are possible across an image, as illustrated in the image shown in figure [1\(](#page-3-0)a), simple thresholding would be ineffective in many cases and could result in the loss of parts of the MTV grid. Therefore, a moving window spatial average of intensities is applied in small neighborhoods within each image. A pixel is selected as the first pixel of interest, and a neighborhood consisting of a square region centered on this pixel is defined. The size of this neighborhood is selected to coincide with the blurring filter standard deviation, being large enough to smooth out most of the noise yet small enough to preserve the structural integrity of the grid lines. The average brightness of the pixels within this neighborhood is calculated and stored within a new moving average image at the same position as the pixel of interest. This process is repeated for each pixel in the image and the result is a moving spatial average image with the same dimensions as the original image. Each pixel in the original image is then compared to the corresponding pixel in the moving spatial average image. If the pixel intensity in the original image is lower than in the averaged image, that pixel is assigned a value of zero. The rest of the pixels' intensities are preserved, therefore resulting in an image where the regions corresponding to high local intensity due to the presence of MTV grid lines are preserved. The result of this thresholding process applied on the image in figure [1](#page-3-0)(a) is observed in figure [1](#page-3-0)(c), where the moving window spatial thresholding preserved 36.5% of the pixels' intensities, all of them laying along the grid lines. For comparison, figure [1\(](#page-3-0)b) shows the result of simple thresholding with an intensity threshold that preserves the same percentage of pixels, but it is clear that relevant parts of the grid are lost and the lack of a 'clean up' of the grid will make the image susceptible to subsequent detection of spurious features.

<span id="page-3-0"></span><span id="page-3-0"></span>Image /page/3/Figure/7 description: The image contains three sub-images labeled (a), (b), and (c). Each sub-image shows a grid-like pattern with varying intensities. Sub-image (a) is in grayscale, with brighter areas concentrated in the center-left. Sub-image (b) is in warm colors, with the same area as (a) showing higher intensity. Sub-image (c) is also in warm colors, with a color bar on the right indicating the intensity scale from 0 to 1. The same area as in (a) and (b) shows the highest intensity in (c).

**Figure 1.** (a) An experimental image with strong intensity variations. (b) Simple threshold. (b) Threshold based on a moving window spatial average of intensities.

#### *2.2. Step 2: Intersection identification*

The binary image pair that results from pre-processing goes through morphological processing to locate areas likely to contain grid intersections. In the first stage of this step, the time-zero binary image is used to determine the average orientation and spacing of the two sets of parallel lines forming the MTV grid. This feature is important to accommodate analysis of data obtained under a variety of experimental conditions with respect to laser alignment and grid spacing. Determination of the orientation and spacing of the grid lines is accomplished using the Hough transform, which detects and parameterizes the straight lines present in the time-zero image. The Hough transform is a voting-based method for the parameterization of patterns present in images, and in its simplest implementation it is capable of simultaneously detecting and parameterizing straight lines. The Hough transform was chosen over other line parameterization methods because it automatically detects and parameterizes lines, it is robust to noise, and it can parameterize multiple lines in an image simultaneously. These qualities are particularly important when processing single-shot, noisy images with varying grid orientations. The best fit line parameters in polar coordinates for a straight line are described using the parameterization ρ = *xi*cosθ + *yi*sinθ. This means that each straight line is described by the length of the normal line that passes through the origin (ρ) and the angle that this normal line makes with the *x* axis (θ). A detailed explanation of this widely employed parameterization is found in (Duda and Hart [1972\)](#page-14-12). Briefly, each point with a value of one contained in the time-zero binary image is translated into a parameter space called the Hough space. In the case of straight line detection in an image, the Hough space is a two-dimensional space where each dimension represents one of the parameters needed to describe the infinite number of straight lines to which each point in the image can belong. In this case, these dimensions are the parameters ρ and θ. Each point of the original image with coordinates *x<sup>i</sup>* and *y<sup>i</sup>* results in a curve in the Hough space that represents all of the possible straight lines that could go through that point. When each point of the original image has been translated to the Hough space, where each position corresponds to a specific combination of ρ-θ parameters, the regions of the Hough space with the most intersections, called the number of votes, correspond to the number of points in the initial image that share the same set of rho-theta parameters, and thus are certain to belong to the same straight line in the original image. Identification of these points in the Hough space results in the detection of the parameters that describe the lines present in the original image. This process is illustrated in figure [2](#page-4-0).

After the straight lines present in the time-zero MTV grid have been identified and parameterized, the lines are classified into two groups based on their angle parameter. In other words, lines are sorted into two groups to separate the two distinct sets of crossing parallel lines forming the MTV grid. After the two average angles are calculated, designated angle 1 and angle 2, the lines are sorted in each group based on their rho parameter. The difference between neighboring rho parameters is calculated and averaged over the group to provide the average grid spacing. The average grid orientation and grid spacing values obtained in this Hough transform parameterization applied to the time-zero binary image are used as inputs for the morphological processing stage, which is applied on both the timezero and time-delayed binary images. The goal of this stage is to make a first determination of the areas where the MTV grid intersections occur. This is accomplished by a process where the time-zero and time-delayed binary images undergo a series of morphological dilations and erosions using different structuring elements to selectively eliminate most of the grid lines and preserve areas containing only the grid intersections (Efford [2000,](#page-14-15) Gonzalez and Woods [2002\)](#page-14-16). The principle behind this process is illustrated in figure [3](#page-5-0) using a schematic of a hypothetical grid intersection formed by one vertical line and one horizontal line present in a binary image.

<span id="page-4-0"></span><span id="page-4-0"></span>Image /page/4/Figure/4 description: The image contains four sub-images labeled (a), (b), (c), and (d). Sub-image (a) shows a black rectangle with a horizontal white line in the middle. Sub-image (b) shows a white grid pattern on a black background. Sub-image (c) shows a plot with the x-axis labeled 'θ' ranging from -90 to 90 and the y-axis labeled 'ρ' ranging from -1000 to 1000. The plot contains two curved lines that intersect at the origin. Sub-image (d) shows a similar plot with the x-axis labeled 'θ' ranging from -90 to 90 and the y-axis labeled 'ρ' ranging from -1000 to 1000. This plot contains multiple curved lines that intersect at several points.

**Figure 2.** Determination of the orientation and spacing of the grid lines using the Hough transform on images with a size 1024 *×* 1024 pixels. A horizontal line (a) is translated into the Hough space (c), where a high density region observed at θ = 0 degrees and ρ = 512 denotes the existence of a straight line with a horizontal orientation and near the center of the image. When an image containing a grid formed by sets of lines crossing at 45 degrees (b) is translated into the Hough space (d), multiple intersections occur at the coordinates corresponding to the parameters that describe such lines.

Morphological processing of each image involves two sequences: one sequence is designed to eliminate all lines not parallel to angle 1. The other sequence is designed to eliminate all lines not parallel to angle 2. During the first sequence, the image is dilated by a square structuring element with an approximate size of one-eighth of the average grid spacing. If the grid is formed by lines oriented diagonally, this structuring element can be shaped as a diamond. Dilation is a process that effectively thickens features, in this case the grid lines. When a structuring element, which contains all values of one, is scanned across all possible positions in the binary image, dilation will produce a new binary image with ones in all of the pixels where the center of the structuring element is positioned when at least one of the pixels of the structuring element overlaps a one in the image that is being processed, *i.e.* when the structuring element 'hits' or 'overlaps' the input image (figures [3](#page-5-0) I *→* IIa and (I) *→* IIb). After this, a line structuring element with a length of approximately one quarter the average grid spacing is used to erode the image in order to remove all of the features shorter than the erosion line length in the erosion line direction. The result is the elimination of all lines perpendicular to the line structuring element and the preservation of all grid lines parallel to it. Erosion is a process that effectively thins features. When a structuring element, which contains all values of one, is scanned across all possible positions in the binary image, erosion will produce a new binary image with ones in all of the pixels where the center of the structuring element is positioned when all of the pixels of the structuring element overlap a region of the image where all of the values are one as well, *i.e.* when the structuring element 'fits' the input image (figure [3](#page-5-0) IIa *→* IIIa). Finally, the resulting eroded image is dilated with a kernel size twice the original dilation kernel size to maximize the possibility of locating the grid intersection area (figure [3](#page-5-0) IIIa *→* IVa). This dilation-erosion-dilation morphological process is then applied to the original binary image to generate another image with the other set of grid lines removed (figure [3](#page-5-0) IIb *→* IIIb *→* IVb). The intersection of the two resulting morphologically processed images (figure [3](#page-5-0) IVa and IVb *→* V) is the area where the intersection point is expected. Figure [4](#page-5-1) shows the image obtained from morphological processing of the images shown in figure [1\(](#page-3-0)c).

<span id="page-5-0"></span><span id="page-5-0"></span>Image /page/5/Figure/2 description: The image shows a diagram with a series of steps or stages arranged in a circular fashion. The diagram consists of several square grids, each representing a different stage, and arrows indicate the progression from one stage to the next. The stages are labeled with Roman numerals and letters, such as 'I', 'IIa', 'IIb', 'IIIa', 'IIIb', 'IVa', 'IVb', and 'V'. Each grid contains a combination of yellow and blue shapes against a gray background. The shapes vary in size and position within the grids, suggesting a transformation or evolution process. The arrangement of the grids in a circle implies a cyclical or iterative process.

**Figure 3.** Morphological processing of a 30 *×* 30 pixel image with a grid intersection formed by one vertical line and one horizontal line with a thickness of 4 pixels, shown in yellow. Structuring elements used for morphological processing are shown in blue.

The original grayscale images undergo a second process of intersection identification that runs in parallel to morphological processing, adding redundancy and reliability to the location of grid intersections. In this second process, called blob detection, grid intersection points are identified using a Hessian blob detector. This detector is widely used in image processing and image vision applications to detect 'blob-like' features in images. In this case, it uses the fact that the overlap of crossing tagged lines occurring at the MTV grid intersections results in local intensity maxima. A 0th order Deriche filter with a standard deviation approximately the thickness of the lines is first applied to the time-zero and time-delayed raw images, resulting in smooth and distinct blobs centered on each intersection point. The centers of these blobs are designated as the centers of the grid intersections, and are mathematically located using the Hessian blob detector, which is based on the Hessian matrix H(*x*,y,σ), or a matrix of second derivatives (Mikolajczyk *et al* [2005,](#page-14-17) Hassaballah *et al* [2016\)](#page-14-18):

$$H(x, y, \sigma) = \begin{bmatrix} I_{xx}(x, y, \sigma) & I_{xy}(x, y, \sigma) \\ I_{xy}(x, y, \sigma) & I_{yy}(x, y, \sigma) \end{bmatrix}$$

where Ixx, Iyy, and Ixy are the image intensities' second derivatives. In practice, this feature detection method searches for locations in the image with strong derivatives in two orthogonal directions, *i.e.* where the determinant of the Hessian matrix, det(*H*) = *IxxIyy − Ixy* 2 , has a local maximum. Approximation of the second derivatives of image brightness allows for interpolation between pixels to obtain sub-pixel detection of the local maxima. The Hessian detector was chosen over simple local intensity maxima because the determinant of the Hessian matrix indicates the locations in the image with strong derivatives in two directions, which penalizes long features such as lines that only have strong second derivatives in one direction. Round blob-like features such as the regions at the grid intersections with strong derivatives in two directions are rewarded in the process. Applying an intensity threshold to the determinant of the Hessian image to select the features stronger than the rest of the features in the image ensures that only intersection points are selected. Red circles in figure [5](#page-6-0) show the intersections which result after processing the image shown in figure [1\(](#page-3-0)c). Features erroneously detected as intersections because of noise or image imperfections are eliminated in the next step, described below.

<span id="page-5-1"></span><span id="page-5-1"></span>Image /page/5/Figure/6 description: The image shows a black and white image of a grid-like pattern. The grid is composed of small, white, rectangular shapes against a black background. The shapes are arranged in rows and columns, forming a matrix-like structure. The shapes are not perfectly aligned, and there are some irregularities in the spacing and orientation of the shapes. The overall impression is that of a pattern or texture.

**Figure 4.** Image resulting from morphological processing of the image shown in figure [1](#page-3-0)(c). White areas outline parts of the grid where an intersection is likely to occur.

The final intersection identification, independently implemented on the time-zero and time-delayed images, consists of a comparison of the areas where intersections were detected by morphological processing and the intersection points extracted through blob detection. If a point identified during blob detection falls within an intersection area identified during morphological processing—a redundancy check that increases the likelihood of detecting intersection points—the point is kept. If the point falls outside of such areas, it is discarded.

<span id="page-6-0"></span><span id="page-6-0"></span>Image /page/6/Figure/1 description: The image shows a black background with many white shapes scattered across it. Each white shape has a red circle in its center. The white shapes appear to be somewhat uniform in size and shape, resembling small, irregular squares or rectangles. The red circles are consistently positioned within each white shape, suggesting a pattern or structure to the arrangement.

**Figure 5.** Comparison of the detected intersection areas using morphological processing (shown in white) to the detected intersections points using blob detection (red circles) for the image shown in figure [1](#page-3-0)(c).

#### *2.3. Step 3: Grid measurement and tracking*

The intersection points in the time-zero image are coupled to the corresponding intersection points in the time-delayed image. Given that the time delay between the time-zero and the time-delayed images is controlled to avoid large flow displacements in an MTV experiment, the simplest way of finding a solution to an intersection point coupling problem would involve a naïve nearest neighbor assignment. However, this solution would not account for potentially missing intersections in one of the two images when signal levels are low and when time-delayed images present significant distortion or out-of-plane movement that could result in areas of multiple missing intersection points. Instead, in order to couple intersections with higher confidence, intersection coupling can be treated as a global assignment problem where the solution is found by minimizing the total distance between coupled intersection points. This combinatorial approach also avoids coupling points far away from each other when most intersection points have already been coupled. The coupling process starts by dividing the intersection points into two sets: time-zero and time-delayed. A modified Hungarian algorithm is then employed to couple all of the points contained in the smallest of the two sets to the optimal points in the largest set (Dell'Amico and Toth [2000](#page-14-19)). The Hungarian algorithm finds enables optimal solution to the point coupling problem where the total distance between time-zero and time-delayed intersections is minimized. Given that each point in the smallest set will be coupled to a point in the largest set, the presence of at least one spurious point in the smallest set or failure in the identification of real intersections would lead to erroneous pair assignments. These limitations are addressed by adding mock points to the largest set at a distance slightly greater than the largest expected coupling distance based on the time delay used to capture the MTV image pair. If there is one spurious point clearly not belonging to the MTV grid in the small set, it will likely be coupled to one mock point in the largest set by the algorithm. Without adding mock points, a wrong assignment involving a spurious point would otherwise trigger a series of multiple erroneous couplings. This approach introduces flexibility to the global assignment problem by minimizing the number of wrong couplings at small computational cost.

<span id="page-6-1"></span><span id="page-6-1"></span>Image /page/6/Figure/7 description: The image shows a diagram with a grid of dots, and two graphs. The grid of dots is labeled with axes ranging from 0 to 800. A red oval highlights the dots at approximately y=450. A blue oval highlights the dots at approximately x=450. An arrow points from the red oval to a graph on the right, which shows a vertical line of dots at x=450. An arrow points from the blue oval to a graph on the bottom, which shows a horizontal line of dots at y=450.

**Figure 6.** Intersection point clustering process for a grid formed by sets of horizontal and vertical laser lines to find the number of intersections in the grid.

The point coupling process by itself provides an initial two-component velocity measurement with a spatial resolution limited by the MTV grid size. Increasing the spatial resolution, however, requires additional processing to obtain grid displacement measurements along the lines connecting intersections. To accomplish this, identification of adjacent intersections is needed, *i.e.* those intersections directly connected by the MTV grid lines. This task is treated as another global optimization problem. When the grid intersections are formed by intersecting sets of horizontal and vertical laser lines, such as the ones shown in figure [6,](#page-6-1) this process would involve the identification of the left, right, upper, and lower nearest neighbors for each intersection point, given that they exist within a certain distance consistent with the previously determined average grid spacing. Since some intersection points could be missing—due to low image quality, for example—the number of expected intersections present in the entire grid is calculated by sorting the detected intersections by their *x* and *y* coordinates. Intersections along any row should have similar *y* coordinates, and intersections along the same column should have similar *x* coordinates. This sorting is performed by clustering the grid intersections by their similarities in terms of *x* and *y* coordinates, separately. Determining the number of clusters in each image is equivalent to finding the number of rows or columns of intersections. When all *x* coordinates of the intersection points are taken into account, each intersection point is initially considered an individual cluster. This is followed by merging the closest clusters to form new larger clusters. Doing this clustering separately for the *x* and *y* coordinates results in the determination of the number of intersection point rows or columns expected in the grid. This clustering process is only performed on the time-zero grid intersections because the lack of distortion and potentially higher signal-to-noise levels make the clustering process more reliable due to the formation of more distinctive clusters. Since the time-zero and time-delayed intersections are coupled in the previous step, clustering the time-zero intersections automatically results in clustering the time-delayed intersections. Clustering by similarity of *x* and *y* coordinates is illustrated in figure [6.](#page-6-1)

<span id="page-7-0"></span><span id="page-7-0"></span>Image /page/7/Figure/2 description: The image contains three scatter plots labeled (a), (b), and (c). Plot (a) shows a grid of points with x and y axes ranging from 0 to 1000. Plot (b) shows a similar grid of points, but with two lines intersecting at the origin. The x-axis ranges from 0 to 1000, and the y-axis ranges from -1000 to 1000. The points above the upper line are shaded. Plot (c) shows a grid of points that has been rotated and scaled. The x-axis ranges from -600 to 800, and the y-axis ranges from -1400 to 200. A red rectangle is drawn around a subset of the points in the upper left corner of the plot.

**Figure 7.** Coordinate transformation to arrange any MTV grid orientation into a grid of vertical and horizontal lines. (a) Plot of original intersection points in a time-zero image with a grid formed by sets of parallel lines at 30 degrees from the vertical axis. (b) Plot of points in (a) with two lines at the grid angles detected using the Hough transform. (c) Transformed intersection points, where the *x*-axis represents the shortest distance from each point to one of the lines in (b), and the *y*-axis represents the shortest distance from each point to the other line. The order of the axes does not affect the result.

In cases where the MTV grid is 'written' using non-axis aligned laser lines, the clustering method would not work as described because intersections along a grid line will not share similar *x* or *y* coordinates. To address this issue, the intersections' coordinates are transformed to form a grid of horizontal and vertical lines. This transformation process is illustrated in figure [7,](#page-7-0) and involves drawing two straight lines starting at an arbitrary origin located at the bottom left corner of the image, at the two grid lines' angles previously determined using the Hough transform (figure [7\(](#page-7-0)b)). Then, the shortest distance from each intersection point to each of the two lines is calculated and the points are plotted using the two distances as the new *x* and *y* coordinates. This results in the intersection points arranged in an orthogonal grid with well-defined rows and columns (figure [7](#page-7-0)(c)).

Once the number of rows and columns in the MTV grid are determined by the clustering process, each intersection point in the time-zero grid is assigned to a row and column number and then placed in a matrix sorted by the row and column to which they belong. The row assignments go from top to bottom and the column assignments go from left to right. This matrix results in adjacent intersection points placed next to each other (table [1\)](#page-8-0). Pairs of columns in the matrix contain the *x* and *y* coordinates of each column of intersections in the MTV grid, and each row in the matrix corresponds to a row of intersection points in the MTV grid. A second matrix is created replacing each point in the time-zero matrix with its corresponding intersection point in the time-delayed image, as identified by the point coupling stage. Since the clustering process has already assigned a row and a column to each intersection point, this sorting method identifies missing intersection points and results in all intersection points being placed directly adjacent to other points to which they are directly connected by a grid line in the experimental image.

Once neighboring intersections have been placed next to each other in the sorting matrices, the gridline segments between intersections are parameterized. This process begins by estimating the angle of a straight line connecting two intersections using the intersections' original coordinates, and a small analysis window that includes only these two intersections is defined in the binary images (figure [8](#page-8-1)(a)). To automate and standardize the process, this sub-image, regardless of its original orientation, is rotated such that the straight line connecting the two intersections is parallel to the *x*-axis (figure [8](#page-8-1)(b)). These analysis windows are chosen to contain only the area in the binary image between these two intersections, eliminating all points with x values outside this range and thus omitting points that could interfere with the parameterization (figure [8](#page-8-1)(c)). The remaining binary image points are fitted using multivariate adaptive regression splines (MARS) to parameterize this section of the grid (figure [8](#page-8-1)(d)). MARS is a non-parametric regression technique that captures nonlinearities at a number of intervals divided by cut points known as knots. The final number of knots is driven by a maximum reduction in residual errors. MARS is used instead of other spline-fitting methods since it is a computationally efficient regression technique and is capable of automatically selecting the number and location of knots to minimize errors (Friedman [1991](#page-14-20)). The choice of the appropriate number of knots is determined by the MARS algorithm using generalized cross-validation (GCV) (Friedman [1991](#page-14-20)). Besides leading to a faster algorithm, we have observed that the use of GCV in MARS leads to consistent solutions. This process is repeated for each pair of intersection points directly connected by the MTV grid for both time-zero and time-delayed images.

<span id="page-8-0"></span><span id="page-8-0"></span>**Table 1.** Matrix for the time-zero (top) and time-delayed (bottom) intersection points arranged by their spatial orientation in the MTV grid. The first two columns show the *x* and *y* coordinates, respectively, for the intersection points along the first column of intersections in the MTV grid. The third and fourth columns show the coordinates for the intersection points along the second column of intersections in the TV grid, etc. The intersections shown in this table correspond to the region outlined in red in figure [7](#page-7-0)(c).

|       | X1    | Y1     | X2     | Y2     | X3     | Y3     | X4     | Y4     | X5     | Y5     | X6     | Y6     |
|-------|-------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|
| Row 1 | NA    | NA     | NA     | NA     | NA     | NA     | NA     | NA     | 39.12  | 222.00 | 85.26  | 141.9  |
| Row 2 | NA    | NA     | NA     | NA     | NA     | NA     | 39.12  | 382.00 | 85.38  | 302.00 | 131.50 | 222.00 |
| Row 3 | NA    | NA     | NA     | NA     | 39.12  | 542.00 | 85.38  | 462.00 | 131.50 | 382.00 | 177.61 | 302.0  |
| Row 4 | NA    | NA     | 39.12  | 702.00 | 85.38  | 622.00 | 131.50 | 542.00 | 177.61 | 462.00 | 223.91 | 382.00 |
| Row 5 | 39.12 | 862.00 | 85.38  | 782.00 | 131.50 | 702.00 | 177.61 | 622.00 | 223.91 | 542.00 | 270.08 | 462.00 |
| Row 6 | 85.31 | 942.02 | 131.50 | 862.00 | 177.61 | 782.00 | 223.91 | 702.00 | 270.08 | 622.00 | 316.38 | 542.00 |
| Row 1 | NA    | NA     | NA     | NA     | NA     | NA     | NA     | NA     | 71.91  | 214.67 | 119.43 | 136.60 |
| Row 2 | NA    | NA     | NA     | NA     | NA     | NA     | 68.14  | 377.94 | 119.01 | 296.21 | 165.46 | 214.70 |
| Row 3 | NA    | NA     | NA     | NA     | 50.28  | 543.18 | 103.98 | 460.90 | 161.88 | 379.90 | 210.72 | 297.75 |
| Row 4 | NA    | NA     | 71.38  | 707.17 | 110.88 | 624.13 | 145.69 | 542.75 | 197.54 | 461.40 | 254.38 | 380.30 |
| Row 5 | 71.64 | 868.48 | 119.45 | 789.00 | 164.50 | 705.31 | 204.06 | 623.82 | 238.99 | 542.74 | 290.45 | 461.72 |

<span id="page-8-1"></span><span id="page-8-1"></span>Image /page/8/Figure/3 description: The image shows four different versions of the same shape. In (a), the shape is filled with vertical lines. In (b), the shape is filled with small dots. In (c), the shape is also filled with small dots, but the dots are more densely packed. In (d), the shape is filled with small dots, and a red line is drawn across the shape. There are also two vertical lines in (d).

**Figure 8.** Spline parameterization. (a) Analysis window surrounding two intersections in a binary image. (b) Rotated analysis window. (c) Cropped analysis window. (d) Parameterization along the grid at even intervals, in this case at two locations between the grid intersection points.

The following stage of the process establishes a correlation between the spline parameterization of the time-zero grid to the spline parameterization of the time-delayed grid. This spline mapping is what provides an increased spatial resolution to the MTV measurement beyond what is given by just the grid intersection points' displacements. Once the timezero and time-delayed segments of the grid have been aligned as in figure [8\(](#page-8-1)c), points at select percentages of the spline parameterizations of the line segments along the *x*-axis are found on the time-zero segment and time-delayed segments, and the *y*-values which correspond to these select *x*-axis values are found. These select percentages can be an arbitrary parameter based on the desired spatial resolution of the final MTV measurement. For example, if the desired result is one additional grid displacement measurement in between intersections, this percentage is 50%. If two additional measurements in between intersections are desired, the percentages are 33.3% and 66.6%, etc. The maximum resolution is arbitrarily large because the parameterization of the grid lines is continuous. Matching the corresponding points between the time-zero and time-delayed segments results in a direct measurement of the local grid displacements along line segments. It is noteworthy that this methodology allows for the direct measurement of MTV grid displacements with an arbitrary spatial resolution, resulting in a continuous velocity measurement along the grid lines and minimizing the errors incurred by interpolating measurements only at the MTV grid intersection points.

#### *2.4. Vector field generation*

The final step of this methodology involves the generation of the final velocity field based on a list of point pairs generated by intersection point coupling and spline mapping. This is accomplished by calculating the difference between each time-delayed point coordinate and the corresponding timezero point coordinate (figure [9](#page-9-0)). These points can also be used to generate a continuous velocity map via additional interpolation.

<span id="page-9-0"></span><span id="page-9-0"></span>Image /page/9/Figure/1 description: The image contains two sub-images, labeled (a) and (b). Both sub-images depict vector fields within a square grid. In sub-image (a), the vectors are generally oriented towards the right, but with a slight upward angle that decreases from bottom to top. The vectors are relatively uniform in length and direction. In sub-image (b), the vectors are predominantly oriented to the right, with a much smaller magnitude compared to those in sub-image (a). The vectors are arranged in horizontal rows, with slight variations in direction and magnitude within each row.

**Figure 9.** Flow displacement vector field resulting from the algorithm output at the intersection points (a) and along the gridlines at three locations in addition to the MTV grid intersection points (b). These vector maps were obtained from the determination of grid displacements using the time-zero and time-delayed MTV synthetic images shown in figures 10(a) and (b), respectively.

#### 3. Performance

The performance of the proposed methodology is presented in the context of precisions and accuracies when directly compared to those achieved by other analysis methodologies, namely cross-correlation and the Hough Transform. For a direct comparison, the datasets presented initially consist of synthetic images previously analyzed using those two methodologies (Sanchez-Gonzalez et al 2015). Briefly, the synthetic images were derived from computational fluid dynamics (CFD) simulations of the flow movement in the wake of a 3.2 mm diameter cylinder in a Mach 4.6 flow (Sanchez-Gonzalez et al 2012a, Sanchez-Gonzalez et al 2015). Maps of the streamwise and radial velocity components resulting from these CFD simulations are shown in the left panels of figure 11 (first and second row, respectively). The synthetic timezero MTV image consists of a perfect grid formed by sets of straight vertical and horizontal lines, crossing at 90 degrees, a line width W of 20 pixels full-width half-maximum, and even line spacing of 80 pixels (figures 10(a) and (b)). All images have a size of  $1024 \times 1024$  pixels and represent a flow field region of  $1.8 \times 1.8$  cm.

The second image pair from left to right shown in figure 11 shows the streamwise and radial velocity maps resulting from the analysis of the single-shot image pair with a signal-to-noise level of 1 (shown in figures 10(a) and (b)). These velocity maps are displayed following interpolation of the calculation output which determined grid displacements at every grid intersection and at three points between intersections. The results are in good quantitative agreement with the original CFD simulation, with differences below 1 pixel, corresponding to 17 m s<sup>-1</sup> for both streamwise and radial velocity for the simulated spatial resolution and time delay. It is worth mentioning that these results were obtained from the analysis of a single shot image pair with a low signal-to-noise level of 1, and some of these differences can be attributed to random fluctuations originating from the image noise. The differences with respect to CFD achieved by analysis using Hough transform and crosscorrelation methodologies are within 20 m s<sup>-1</sup> for noise-free versions of the same images (Sanchez-Gonzalez *et al* 2015).

<span id="page-9-1"></span><span id="page-9-1"></span>Image /page/9/Picture/6 description: The image shows six different grid patterns labeled (a) through (f). Pattern (a) is a standard square grid. Pattern (b) shows a grid that is distorted, with the squares compressed in the middle. Patterns (c) through (f) show grids that are increasingly skewed, forming diamond shapes. The diamonds in pattern (f) are the most elongated.

**Figure 10.** Single-shot synthetic grid images with different grid orientations at time-zero (left panels) and after a time delay (right panels) with a signal-to-noise level of 1. The images represent a square region of  $18 \times 18$  mm.

This methodology's accuracy and flexibility were further evaluated using images with different grid orientations. Additional synthetic images were generated using grids formed by sets of parallel lines at 45° (figures 10(c) and (d)) and 30° (figures 10(e) and (f)) with respect to the vertical axis, simulating experimental sets of laser lines propagating from top to bottom. In addition to serving as a test for the methodology's ability to handle different grid orientations, these images illustrate a more realistic case in terms of experimental configurations in facilities where the only option is to align lasers from above or below the flow and capture the grid's light emission at 90 degrees from the imaging plane. Figure 11 shows the results of the analysis of single-shot images pairs with signal-tonoise levels of 1 for all grid orientations. In all cases, the small differences within 17 m s<sup>-1</sup> for both streamwise and radial velocities, which can be attributed to image noise and interpolation to generate a continuous colormap. The largest differences between the algorithm's output and the original CFD simulations appear at the location of the strongest gradients of the flow, as seen in figure [11](#page-10-0). It has been previously noted that unphysical results with a spatial frequency of the employed MTV grid are more likely to occur when the orientation of the flow's velocity gradients depart from alignment with the grid (Ramsey and Pitz [2011](#page-14-0)). In our case, we observed that these differences are the smallest for the 90 degree grid. There are two main factors that contribute to the spatial resolution of an MTV measurement. The first factor is the frequency of the employed grid, which is what ultimately limits the resolution. The second factor is the ability to make determinations along the 'written' grid. The proposed methodology can only provide increased spatial resolution displacement determinations along the grid lines.

      <span id="page-10-0"></span><span id="page-10-0"></span>Image /page/10/Figure/2 description: The image shows a comparison of computational fluid dynamics (CFD) simulations with results obtained using different grid orientations (90°, 45°, and 30°) for streamwise velocity, radial velocity, and vorticity. The streamwise velocity is measured in meters per second (m/s), radial velocity is measured in m/s, and vorticity is measured in radians per second (rad/s). The color scales indicate the magnitude of each quantity, with warmer colors representing higher values and cooler colors representing lower values. The vorticity values are multiplied by 10 to the power of 5.

**Figure 11.** Streamwise and radial velocity maps derived from synthetic single-shot image pairs at different grid orientations with a signal-to-noise ratio of 1. Continuous maps were generated using linear interpolation of determinations at the grid intersections and at three points between intersections. The white dotted box on the top left panel of figure 11 indicates the area with the largest grid distortions used to calculate the results shown in figure [12](#page-11-0).

The bottom panels of figure [11](#page-10-0) show the out-of-plane component of vorticity, *ω<sup>z</sup>* = *dυ/dx − du/dy*, for the CFD simulation and the synthetic single-shot images at different grid orientations. Vorticity determinations require the calculation of velocity gradients in two different directions. Given the limit imposed by the discrete nature of the MTV grid, it is impossible to get direct measurements of these two gradients at the same time. In the 90 degree grid, for example, only the horizontal or vertical gradients can be directly determined along the grid lines, but not both. A vorticity determination using the proposed methodology will depend on the interpolated velocity maps, and will be subject to the errors of the interpolations. The possibility of direct vorticity measurements in MTV experiments at the grid intersections has been previously shown by determination of the rotation of the grid intersections using template matching (Ramsey and Pitz [2011](#page-14-0)) and Hough-transform (Sanchez-Gonzalez *et al* [2015\)](#page-14-1) analysis methodologies.

Additional datasets were generated to assess the effect of random noise on the algorithm performance. Based on the same CFD simulations, sets of 100 image pairs similar to the ones shown in figure [10](#page-9-0) with signal-to-noise levels ranging from 1 to 20 were generated and analyzed. Adding random noise, characterized by a normal distribution, resulted in images with varying signal-to-noise defined as the ratio of the MTV line intensities' amplitude divided by the noise peak-topeak amplitude. Resulting root-mean-square (RMS) displacements in pixels are plotted in the top panel of figure [12](#page-11-0) as a function of signal-to-noise level. Separate plots for RMS displacement determinations at a grid intersection and along the grid lines halfway between intersections are provided to illustrate methodology's capability to increase the measurement spatial resolution using the entire MTV grid without sacrificing performance. The plots show results obtained in the region located in the left center of the images, where the largest grid distortions occur and where the highest RMS displacements are observed. As seen in the top panel of figure [12,](#page-11-0) RMS values for all signal-to-noise levels are below 0.5 pixels for all grid orientations, with all RMS displacements mostly below 0.1 when signal-to-noise exceeds a value of 5. These uncertainties are comparable with the best performance shown by cross-correlation and Hough transform methodologies for the same datasets (Sanchez-Gonzalez *et al* [2015](#page-14-1)). Those other methodologies, however, provide results limited to the grid intersections and only achieve their best performance when the size of analysis windows around each intersection is optimized by trial and error. This methodology does not suffer from such limitations.

<span id="page-11-0"></span><span id="page-11-0"></span>Image /page/11/Figure/1 description: The image contains three plots showing the relationship between signal-to-noise ratio and RMS displacement in pixels for different grid angles. Each plot has two lines: one representing 'intersections' and the other representing 'between intersections'. The x-axis represents the signal-to-noise ratio, ranging from 0 to 20, and the y-axis represents the RMS displacement in pixels, ranging from 0 to 0.6. The first plot shows data for a 90-degree grid, the second for a 45-degree grid, and the third for a 30-degree grid. In all three plots, the RMS displacement decreases as the signal-to-noise ratio increases. The 'intersections' line is consistently above the 'between intersections' line, indicating a higher RMS displacement at the intersections.

**Figure 12.** Uncertainties for the grid displacement determinations at the intersections and at the middle point along the grid lines as a function of signal-to-noise levels for different grid orientations.

As shown in figure [12](#page-11-0), a small difference was observed for RMS displacements obtained at grid intersections and inbetween intersections. Resulting RMS displacements are larger in between intersection locations for the 90 and 45 degree grids, but the opposite is true for the 30 degree grid. However, these RMS differences between intersections and betweenintersections are within 0.1 pixel for signal-to-noise levels above 2. We have found that these differences for the 90 degree and the 45 degree grids with respect to the 30 degree grid are due to the location of the grid locations with respect to the largest gradients. Higher RMS values were observed in the areas with largest distortion at low signal-to-noise levels, but these differences decrease progressively as signal-to-noise levels increase.

### **4. Experimental data analysis**

Performance was further illustrated by analyzing twocomponent MTV experimental image pairs. The first image pair, shown in figures [13\(](#page-12-0)a) and (b), was obtained in the wake of a Mach 4.6 flow over a cylinder of 6.35 mm diameter, under the conditions and experimental setup reported in (Sanchez-Gonzalez *et al* [2015](#page-14-1)). Although that previous study reported the analysis of experimental time-zero and time-delayed average images based on 200 shots with signal-to-noise levels exceeding 6 and 12, respectively, this work focuses on the analysis of single-shots of the same flow field with signalto-noise levels of approximately 1 and 2 for time-zero and time-delayed images, respectively. The images show a region of 1.5 *×* 1.6 cm at a spatial resolution of 37 pixels mm*−*<sup>1</sup> , obtained at time zero after tagging for the first image of each pair, and at a time delay of 1 *µ*s after tagging for the second image of each pair.

As seen in the resulting vector map that represents the flow velocity at each grid intersection and at two points in between intersections (figure [13](#page-12-0)(c)), except for some regions of a barely visible vertical grid line on the left of the time-zero image, all regions of the grid were properly identified and grid displacements were measured. The bottom panels of figure [13](#page-12-0) show interpolated colormaps of the streamwise and radial velocity components, with black circles identifying the points where the direct calculations of grid displacements were determined. The increased resolution of the grid displacement determinations provided by this methodology minimizes the errors associated with the choice of interpolation method in order to display continuous maps, particularly when drastic grid deformations associated with turbulence or strong gradients could be present in the flow. There are some clear differences between the CFD simulations of the flow and the experimental results shown in figure [13](#page-12-0). These differences can be mainly attributed to assumptions made in the 2D, steady-state CFD simulations (Sanchez-Gonzalez *et al* [2012b\)](#page-14-2) and finite differences between the experimental conditions and those used in the simulations. However, analysis of similar average images with significantly higher signal-to-noise have shown results consistent with to those shown in figure [13](#page-12-0)(c) (Sanchez-Gonzalez *et al* [2015\)](#page-14-1). The present analysis, however, shows the ability of the proposed methodology to increase the spatial resolution of the grid displacement determinations along the grid lines and handle MTV images with significantly lower signal-to-noise levels.

<span id="page-12-0"></span><span id="page-12-0"></span>Image /page/12/Figure/2 description: The image contains five sub-images labeled (a) through (e). Sub-images (a) and (b) show a grid pattern, with (a) appearing more grainy and (b) more clearly defined. Sub-image (c) displays a vector field with arrows pointing predominantly to the right, indicating flow direction. Sub-image (d) is a color-coded map with values ranging from 300 to 750, with warmer colors (reds and oranges) indicating higher values and cooler colors (greens and blues) indicating lower values. The map is overlaid with a grid of small circles. Sub-image (e) is another color-coded map with values ranging from -150 to 150, with red indicating high positive values, blue indicating high negative values, and green indicating values close to zero. This map is also overlaid with a grid of small circles.

**Figure 13.** Analysis of a single-shot MTV image pair obtained in the wake of a cylinder in a supersonic flow. Interpolated colormaps of the streamwise and radial velocities in m s*<sup>−</sup>*<sup>1</sup> are shown in (d) and (e). Black circles in the interpolated velocity maps represent the points where the calculation directly determined displacements at the grid intersections and at two points between intersections. Continuous maps were generated using linear interpolation of determinations at the grid intersections and at two points between intersections.

To illustrate the performance of the algorithm with more drastic grid distortions, experimental single-shot MTV images were obtained using the same flowfield configuration. The quality of the supersonic flow generated by a convergingdiverging-nozzle is highly dependent on pressure matching the gas at the nozzle exit and the vacuum chamber's pressure (Sanchez-Gonzalez *et al* [2012a\)](#page-14-3). This pressure matching is achieved by adjusting the aperture in a needle valve connecting the vacuum chamber with the atmosphere. To obtain a timedelayed image with high grid distortions, the needle valve was simply opened to lose pressure-matched flow, achieving the desired effect. Consequently, all features characteristic of a cylinder wake were lost, and unique image pairs were obtained. A resulting image pair is shown in figures [14\(](#page-13-0)a) and (b), where the distortions in the time-delayed image are clear. To increase the spatial resolution of the velocity measurements in the presence of these drastic distortions, displacement determinations were calculated at the grid intersections and at three points between intersections. Except for a few locations where the grid is missing (likely because of out-of-plane flow motion), the calculation captures all distortions where the time-delayed grid is still visible.

Figures [14\(](#page-13-0)d) and (e) show interpolated colormaps of the streamwise and radial velocity components, where black circles indicate again the points where the algorithm made grid displacement determinations. Increased resolution along the grid lines achieved by the algorithm can provide more confidence in the accuracy of an interpolated colormap.

Finally, it is also worth mentioning that for the reported implementation the methodology via an algorithm written in R, the time to perform the calculations is on average 2x that of Hough-transform methodologies, and on average 15x that of cross-correlation, as reported previously (Sanchez-Gonzalez *et al* [2015\)](#page-14-1). However, those other methodologies only provide displacement determinations at the grid intersections, and their computation time depends on parameters such as the user-selected size of analysis sub-regions surrounding the intersections. The methodology proposed in this work achieves displacement determinations with significantly higher spatial resolution, and the computation time does not depend on parameters that need adjustment to maximize performance, such as analysis window size. According to our best estimate, the time required to make determination of grid displacement only at the grid intersections by the proposed algorithm is comparable to the fastest implementations of Hough transform and cross-correlation methodologies. The majority of the computational time is spent in the subsequent steps, including the spline fitting that provides the increased spatial resolution. The other methodologies do not provide information beyond that at the grid intersections.

<span id="page-13-0"></span><span id="page-13-0"></span>Image /page/13/Figure/2 description: The image contains five sub-images labeled (a) through (e). Sub-image (a) shows a grid pattern. Sub-image (b) shows a distorted grid pattern. Sub-image (c) shows a grid pattern with arrows indicating direction. Sub-image (d) shows a color plot with a grid pattern overlaid. The color scale ranges from 300 to 750. Sub-image (e) shows a color plot with a grid pattern overlaid. The color scale ranges from -150 to 150.

**Figure 14.** Analysis of a single-shot MTV image pair obtained in the wake of a cylinder in a supersonic flow with severe grid distortions. Interpolated colormaps of the streamwise and radial velocities in m s*<sup>−</sup>*<sup>1</sup> are shown in (d) and (e). Black circles in the interpolated maps represent the points where the algorithm determined displacements at the grid intersections and at three points between intersections. Continuous maps were generated using linear interpolation.

### **5. Conclusions**

We have presented the development of a new methodology to analyze two-component molecular tagging velocimetry image pairs to provide grid displacement determinations with high spatial resolution. Increased spatial resolution is achieved by determining grid displacements at the grid intersections as well as along the grid lines. Traditionally, the spatial resolution of an MTV measurement has been limited by the number of grid intersections that in turn depend on the number and the density of the tag lines written onto the flow. The analysis methodology presented in this work is capable of making continuous determinations of the grid displacements along the entire grid lines using a multivariate adaptive regression splines parameterization along the grid segments connecting adjacent intersections. In addition to the increased spatial resolution, this methodology provides a great potential for automation, since it is capable of detecting the orientation of the grid and can handle cases where parts of the grid are missing.

Initial demonstration of the methodology's capabilities were illustrated using synthetic data sets derived from Computational Fluid Dynamics simulations identical to those previously used to assess the performance of Hough-transform and cross-correlation methodologies. The data sets represent flow displacements in the wake of a cylinder in a Mach 4.6 flow. Besides providing comparable results in terms of precision and accuracy, the analysis of images by the proposed methodology results in significantly increased spatial resolution of the flow displacement determinations along the grid lines with a precision and accuracy comparable to those achieved at the grid intersections.

Furthermore, the methodology's ability to handle different grid orientations was assessed using synthetic datasets with grids formed by sets of parallel lines at 90, 45, and 30 degrees from the vertical axis. Comparable results in terms of precision and accuracy were obtained across grid orientations, with uncertainties for all grid orientations below 0.1 pixel for images with signal-to-noise levels exceeding 5, and within 0.5 pixel for the noisiest image sets.

The increased spatial resolution of the grid displacement determinations provided by the proposed methodology is based on spline parameterizations of line segments in the timezero and time-delayed images, and subsequent matching of corresponding points at select percentages of the parameterizations. Although this approach effectively increases the displacement determination resolution to include the MTV grid lines, it is better suited to resolve gradual velocity changes and will lead to the blurring of strong gradients, such as those encountered across normal shock waves. Given the intrinsic limitations of MTV techniques, the benefits of analysis methodologies have to take into account the frequency of the employed grids, which is what ultimately limits spatial resolution.

A version of the algorithm's implementation in R language using open access packages is available at request from the authors for use and improvement by the scientific community.

## **Acknowledgments**

The authors wish to thank the insights provided by Susan Hoops, Oleksandr Dmytrenko, and Matt Richey during the initial stages of this work. We also acknowledge the funding for this research provided by the Center for Interdisciplinary Research at St. Olaf College, as well as the support of NSF (Grant Nos. DMS-1045015 and DMS-0354308).

## **ORCID iDs**

Michael Pearce <https://orcid.org/0000-0002-9313-271X> Zachary Sparrow <https://orcid.org/0000-0001-6163-2843> Thabiso R Mabote [https://orcid.org/0000-0003-4540-](https://orcid.org/0000-0003-4540-7122) [7122](https://orcid.org/0000-0003-4540-7122)

Rodrigo S´anchez-Gonz´alez [https://orcid.org/0000-0002-](https://orcid.org/0000-0002-4477-3799) [4477-3799](https://orcid.org/0000-0002-4477-3799)

### **References**
References were removed from this document. Please see the full publication for details.
